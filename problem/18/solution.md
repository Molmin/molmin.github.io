第一问是最小支配集模板。

考虑树形动态规划。

记 $f_{i,\ 0}$ 表示对于以 $i$ 为根的子树，满足 $i$ 在选定的支配集当中的最小支配集大小；**（被自己支配）**

记 $f_{i,\ 1}$ 表示对于以 $i$ 为根的子树，满足 $i$ 不在选定的支配集当中且存在 $i$ 的一个儿子结点在选定的支配集当中的最小支配集大小；**（被儿子支配）**

记 $f_{i,\ 2}$ 表示对于以 $i$ 为根的子树，满足 $i$ 以及 $i$ 的所有儿子结点都不在选定的支配集当中的最小支配集大小；**（被父亲支配）**

记 $g_{i,\ j}$（$0\leq j < 3$）表示对应 $f_{i,\ j}$ 的情况，支配集大小是最小值的不同支配集个数。

若 $i$ 在选定的支配集当中，则 $i$ 的所有儿子结点已经被 $i$ 结点支配，故无论被自己、儿子还是父亲支配均可，故

$$
f_{i,\ 0}=1+\sum_{j\in\text{son}(i)}\min\{f_{j,\ 0},\ f_{j,\ 1},\ f_{j,\ 2}\}.
$$

相应 $g_{i,\ 0}$ 只需使用乘法原理，找到每个儿子结点的取值来源即可。

若 $i$ 以及 $i$ 的所有儿子结点都不在选定的支配集当中，则 $i$ 的儿子结点不被父亲或自己支配，只能被儿子支配，故

$$
f_{i,\ 2}=\sum_{j\in\text{son}(i)}f_{j,\ 1}.
$$

根据乘法原理易得

$$
g_{i,\ 2}=\prod_{j\in\text{son}(i)}g_{j,\ 1}.
$$

下面考虑 $f_{i,\ 1}$，即 $i$ 不在选定的支配集当中且存在 $i$ 的一个儿子结点在选定的支配集当中。

该情况要求每个儿子结点 $j$ 取值 $f_{j,\ 0}$ 或 $f_{j,\ 1}$，并且至少有一个儿子结点取值 $f_{j,\ 0}$。

若该结点为叶子结点，则无法达到目标，故初始令

$$
\begin{aligned}
f_{i,\ 1} & \gets +\infty \\
g_{i,\ 1} & \gets 1 \\
\end{aligned}.
$$

依次处理每个儿子结点，每遇到一个新的儿子结点 $j$，对之前儿子结点是否存在取值 $f_{j,\ 0}$ 进行分类讨论。

- 若存在，之前儿子结点的支配集最小点数为 $f_{i,\ 1}$，新结点 $j$ 可以取 $f_{j,\ 0}$，也可以取 $f_{j,\ 1}$；

- 若不存在，之前儿子结点的支配集最小点数为 $f_{i,\ 2}$，新结点 $j$ 必须取 $f_{j,\ 0}$。

综上所述，可以得出令

$$
f_{i,\ 1} \gets \min\{f_{i,\ 1}+f_{j,\ 0},\ f_{i,\ 1}+f_{j,\ 1},\ f_{i,\ 2}+f_{j,\ 0}\}
$$

即可，相应 $g_{i,\ 0}$ 只需找到最小值取值来源即可。
